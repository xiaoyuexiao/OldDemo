<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>love</title>
</head>
<style type="text/css">
	*{
		padding: 0;
		margin: 0;
	}
	img
	{
		display: none;
	}
</style>
<body>
	<img src="snow2.jpg" id="snow_1" alt="">
	<img src="snow1.jpg" id="snow_2" alt="">
	<canvas id="canvas1" style="background: black">
		您的浏览器不支持 HTML5 canvas 标签。
	</canvas>
</body>
<script type="text/javascript">
	window.onload = function()
	{

		var can = document.getElementById("canvas1");
	    var ctx = can.getContext("2d");
	    ctx.globalCompositeOperation="destination-over";
	    //画布宽度
	    var wid = window.innerWidth;
	    //画布高度
	    var hei = window.innerHeight;
	    can.width=wid;
	    can.height=hei;
	    var arr = getPos(150,wid,hei);
	    //得到雪花图片
	    var snowImage = document.getElementById('snow_1');   
        var snowImage2 = document.getElementById('snow_2'); 
        //json
        var text = {
				"text":
				[
					[
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,18,17,16,0,0,0,0,3,4,5,0,0,0,0,0],
						[0,0,0,0,19,0,0,0,15,0,0,2,0,0,0,6,0,0,0,0],
						[0,0,0,20,0,0,0,0,0,14,1,0,0,0,0,0,7,0,0,0],
						[0,0,21,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0],
						[0,0,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0],
						[0,0,0,23,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0],
						[0,0,0,0,24,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0],
						[0,0,0,0,0,25,0,0,0,0,0,0,0,0,12,0,0,0,0,0],
						[0,0,0,0,0,0,26,0,0,0,0,0,0,13,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,27,0,0,0,0,31,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,28,0,0,30,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,29,29,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
					],
					[
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,18,17,16,0,0,0,0,3,4,5,0,0,0,0,0],
						[0,0,0,0,19,0,0,0,15,0,0,2,0,0,0,6,0,0,0,0],
						[0,0,0,20,0,0,0,0,0,14,1,0,0,0,0,0,7,0,0,0],
						[0,0,21,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0],
						[0,0,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0],
						[0,0,0,23,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0],
						[0,0,0,0,24,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0],
						[0,0,0,0,0,25,0,0,0,0,0,0,0,0,12,0,0,0,0,0],
						[0,0,0,0,0,0,26,0,0,0,0,0,0,13,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,27,0,0,0,0,31,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,28,0,0,30,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,29,29,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
					],
					[
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,18,17,16,0,0,0,0,3,4,5,0,0,0,0,0],
						[0,0,0,0,19,0,0,0,15,0,0,2,0,0,0,6,0,0,0,0],
						[0,0,0,20,0,0,0,0,0,14,1,0,0,0,0,0,7,0,0,0],
						[0,0,21,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0],
						[0,0,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0],
						[0,0,0,23,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0],
						[0,0,0,0,24,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0],
						[0,0,0,0,0,25,0,0,0,0,0,0,0,0,12,0,0,0,0,0],
						[0,0,0,0,0,0,26,0,0,0,0,0,0,13,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,27,0,0,0,0,31,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,28,0,0,30,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,29,29,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
					],
					[
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,18,17,16,0,0,0,0,3,4,5,0,0,0,0,0],
						[0,0,0,0,19,0,0,0,15,0,0,2,0,0,0,6,0,0,0,0],
						[0,0,0,20,0,0,0,0,0,14,1,0,0,0,0,0,7,0,0,0],
						[0,0,21,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0],
						[0,0,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0],
						[0,0,0,23,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0],
						[0,0,0,0,24,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0],
						[0,0,0,0,0,25,0,0,0,0,0,0,0,0,12,0,0,0,0,0],
						[0,0,0,0,0,0,26,0,0,0,0,0,0,13,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,27,0,0,0,0,31,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,28,0,0,30,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,29,29,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
					],
					[
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,18,17,16,0,0,0,0,3,4,5,0,0,0,0,0],
						[0,0,0,0,19,0,0,0,15,0,0,2,0,0,0,6,0,0,0,0],
						[0,0,0,20,0,0,0,0,0,14,1,0,0,0,0,0,7,0,0,0],
						[0,0,21,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0],
						[0,0,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0],
						[0,0,0,23,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0],
						[0,0,0,0,24,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0],
						[0,0,0,0,0,25,0,0,0,0,0,0,0,0,12,0,0,0,0,0],
						[0,0,0,0,0,0,26,0,0,0,0,0,0,13,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,27,0,0,0,0,31,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,28,0,0,30,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,29,29,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
					],
					[
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,18,17,16,0,0,0,0,3,4,5,0,0,0,0,0],
						[0,0,0,0,19,0,0,0,15,0,0,2,0,0,0,6,0,0,0,0],
						[0,0,0,20,0,0,0,0,0,14,1,0,0,0,0,0,7,0,0,0],
						[0,0,21,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0],
						[0,0,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0],
						[0,0,0,23,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0],
						[0,0,0,0,24,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0],
						[0,0,0,0,0,25,0,0,0,0,0,0,0,0,12,0,0,0,0,0],
						[0,0,0,0,0,0,26,0,0,0,0,0,0,13,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,27,0,0,0,0,31,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,28,0,0,30,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,29,29,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
						[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
					]
				]
		}	
		console.log("max:"+getMaxTowArr(text.text[0]));
        // ctx.drawImage(snowImage, p.x, p.y,imgr*2, imgr*2);
      	//drawText("黎肖",110,100,50,ctx);
      	var flag = 0;
		setInterval(function(){
			flag = flag + 50;
			draw(arr,ctx,snowImage,wid,hei,8);
			var strarr = text.text;
			var alltime = 0;
			for (var i = 0; i < strarr.length; i++) {
				var flag2 = flag/50;
				var max = getMaxTowArr(strarr[i]);
				alltime = alltime + max*50;

				for (var z = 0; z < max; z++)
				{
					for (var j = 0; j < strarr[i].length; j++) 
					{
						for (var k = 0; k < 20; k++) {
							if (strarr[i][j][k] != 0)
							{
								if (strarr[i][j][k]<flag2)
								{
									drawText("☆",100+i*200+k*2,100+j*2,10,ctx);
									drawText("☆",100+(i+1)*200+k*10,100+j*10,2,ctx);
									drawText("☆",100+i*200+(k+1)*10,100+j*10,2,ctx);
									drawText("☆",100+i*200+k*10,100+(j+1)*10,2,ctx);
									//drawText("☆",100+i*200-30+j*10,100+k*10+40,10,ctx);
									//drawText("☆",-(100+i*200+j*10),-(100+k*10),10,ctx);
									//drawText("☆",-(100+i*200+j*10),100+k*10+40,10,ctx);
								}
								
							}
						}
					}
				}
				
			}

			if (0 <=flag && flag <=300)
			{
				drawText("黎",30,100,50,ctx);
			}
			if (flag >=300 && flag <=600)
			{
				drawText("肖",30,100,50,ctx);
			}
			if ( 600 <= flag && flag <=1000)
			{
				drawText("黎肖",30,100,50,ctx);
			}
			if (flag <=2000 && flag >1000)
			{
				drawText("黎肖我爱你",30,100,50,ctx);
			}
			if (flag <=3000 && flag>2000)
			{
				drawText("",30,100,50,ctx);
			}
			if (flag > 3000)
			{
				drawText("hahhahahha",30,100,50,ctx);
			}
		},100);
		
		
		// setInterval(function(){
		// 	draw(arr,ctx,snowImage,wid,hei,12);
		// },94);

		// setInterval(function(){
		// 	draw(arr,ctx,snowImage,wid,hei,12);
		// },50);

		// setInterval(function(){
		// 	draw(arr,ctx,snowImage,wid,hei,12);
		// },30);

		// setInterval(function(){
		// 	draw(arr,ctx,snowImage,wid,hei,12);
		// },20);

		// setInterval(function(){
		// 	draw(arr,ctx,snowImage,wid,hei,12);
		// },10);

		// setInterval(function(){
		// 	draw(arr,ctx,snowImage,wid,hei,12);
		// },70);


	}
    
	//画函数
    function draw(arr,ctx,snowImage,wid,hei,r)
    {

        //画
        var counter = 0;
        ctx.clearRect(0, 0, wid, hei);
        ctx.beginPath();
        for (var i = 0; i < arr.length; i++) {
            var p = arr[i];
            //var snow_image = (p.snowType == 0)?snowImage:snowImage2;
            // if(counter % 3 == 0){  //每3张切换一次图片
            //    p.snowType = 1 - p.snowType;
            // }
	        var imgr = 0.6 * r + 1;
            ctx.drawImage(snowImage, p.x, p.y,imgr*2, imgr*2);
        }
        ctx.fill();
        snowDown(arr,wid,hei);
        ctx.closePath();
    }

    function getPos(count,wid,hei)
    {
    	//得到雪花的位置和半径
    	var arr = []; //保存各圆坐标及半径
	    for (var i = 0; i < count; i++) {
	        arr.push({
	            x: Math.random() * wid,
	            y: Math.random() * hei,
	            snowType:0
	        })
        }
        return arr;
    }

    function snowDown(arr,wid,hei)
    {
    	for (var i = 0; i < arr.length; i++) {
            var p = arr[i];
            p.y += Math.random() * 1 + 2;
            if (p.y > hei) {
                p.y = 0;
            }
            p.x += (Math.random()-0.5) * 8;
            if (p.x > wid) {
                p.x = 0;
            }
        }
    }

    function drawText(str,pos_x,pos_y,size,ctx)
    {
    	ctx.font= size+"px Arial"
    	ctx.fillStyle="#058"
    	ctx.fillText(str,pos_x,pos_y)
    }

    function getMaxTowArr(arr)
    {
    	var max = 0;
    	for (var i = 0; i < arr.length; i++)
    	{
    		for (var j = 0; j < arr[i].length; j++)
    		{
    			if (max<arr[i][j])
    			{
    				max = arr[i][j];
    			}
    		}
    	}
    	return max;
    }

    function drawTextAll(arr,i,ctx)
    {
    	for (var j = 0; j < arr.length; j++) 
    	{
    		for (var k = 0; k < 20; k++) {
    			if (arr[j][k] != 0)
    			{
    				if (arr[j][k]<flag2)
    				{
    					drawText(arr[j][k],100+i*200+k*10,100+j*10,10,ctx);
    				}
    				
    			}
    		}
    	}
    }
</script>

</html>